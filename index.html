<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Binanced</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic appeal and dark mode */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap');
        
        /* Define the base dark color - updated to #040404 */
        :root {
            /* Very dark charcoal background color, almost pure black */
            --background-match-color: #040404; 
            /* Slightly darker card color for better contrast against the new background */
            --card-color: #222222;
        }

        body {
            font-family: 'Inter', sans-serif;
            /* Use the color that exactly matches the image edge for a seamless blend */
            background-color: var(--background-match-color); 
            
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            
            /* Increased padding-top to ensure content starts BELOW the 600px fixed graphic (600px + 20px buffer) */
            padding-top: 620px; 
            position: relative;
        }

        /* --- Background Container for Image --- */
        #background-graphic {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            /* Height for a bigger visual area */
            height: 600px; 
            overflow: hidden;
            z-index: 1; /* Below the main app container */
            /* Reverted to flex for simple centering */
            display: flex;
            justify-content: center;
            background-color: var(--background-match-color); 
        }

        /* 2. Sharp Image (img) - layered on top */
        #background-graphic img {
            /* Reverted positioning to allow flex centering */
            
            /* Keep size properties for responsiveness */
            width: 90%; 
            max-width: 600px; 
            height: auto;
            object-fit: contain;
            
            /* z-index is removed as it is no longer layered absolutely */
        }
        
        /* 3. The Gradient Overlay (to handle the final seamless color fade) */
        #background-gradient-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Uses a tight elliptical radial gradient to mask the edge and color blend */
            background: radial-gradient(
                ellipse 100% 100% at center, 
                rgba(4, 4, 4, 0) 80%,                /* Fully transparent near the center */
                var(--background-match-color) 100%      /* Fades into the exact background color at the edge */
            );
            z-index: 2; /* Highest layer for the final color blend */
        }

        /* Container for the main interactive elements */
        .main-app-container {
            max-width: 400px; 
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px; 
            
            z-index: 10; 
            position: relative;
        }

        /* Input Block (floating card effect) */
        .input-block {
            background-color: var(--card-color); 
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7); 
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        /* Styling for the Primary Button */
        .button-primary {
            background-color: #fcd34d; /* Amber/Gold theme color */
            color: #1f2937; /* Dark text on button */
            transition: all 0.2s;
            font-weight: 700;
        }
        .button-primary:hover {
            background-color: #fbbf24; /* Darker amber on hover */
            box-shadow: 0 4px 12px rgba(252, 211, 77, 0.6);
        }

        /* Style for the loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.3);
            border-top: 4px solid #1f2937; 
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    
    <!-- Background Image - Now seamlessly blended and larger -->
    <div id="background-graphic">
        <!-- Note: Using a placeholder URL for the Binance glasses image for demonstration. You should ensure this image is accessible. -->
        <img src="https://getbinanced.sirv.com/getbinanced.jpg" alt="Binance Wayfarers Graphic" />
        <div id="background-gradient-overlay"></div>
    </div>


    <div class="main-app-container">
        <!-- Input Block -->
        <div class="space-y-6">
            <!-- File Upload -->
            <input type="file" id="image-upload" accept="image/*" class="w-full text-sm text-gray-200 file:mr-4 file:py-3 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-gray-900 hover:file:bg-amber-200 transition duration-150 rounded-full cursor-pointer p-1 border border-gray-600">
            
            <!-- Generate Button -->
            <button id="generate-button" onclick="handleGenerate()" class="button-primary font-semibold w-full py-3 px-6 rounded-full shadow-lg flex items-center justify-center mt-6" disabled>
                <span id="button-text">Get Binanced</span>
                <div id="loading-spinner" class="spinner ml-3 hidden"></div>
            </button>
            
            <!-- Message Area -->
            <div id="message-box" class="mt-4 p-3 text-sm text-red-300 bg-red-900 rounded-lg hidden w-full"></div>
        </div>

        <!-- Result Image Section (Hidden initially, floats below input block) -->
        <div id="result-container" class="w-full hidden mt-8">
            <!-- Placeholder/Loading area -->
            <div id="image-preview-container" class="w-full bg-gray-700 rounded-lg overflow-hidden flex items-center justify-center p-4 min-h-[300px]">
                <img id="image-preview" src="https://placehold.co/400x400/444444/bbbbbb?text=Upload+Your+Photo" alt="Image Preview" class="max-w-full max-h-full rounded-lg object-contain" style="display: block;">
            </div>

            <!-- Generated Image area -->
            <img id="result-image" src="" alt="Generated Image" class="w-full h-auto rounded-lg shadow-xl" style="display: none;">
            
            <!-- Message for the user to save the generated image -->
            <p id="result-message" class="text-sm text-gray-500 text-center mt-4 hidden">
                (Right-click or long-press the generated image to save it)
            </p>
        </div>
    </div>

    <!-- Contract Address Footer -->
    <div class="mt-8 w-full max-w-lg text-center p-4" style="background-color: var(--card-color); border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); border: 1px solid #374151;">
        <p class="text-sm font-medium text-yellow-400">Official Contract Address:</p>
        <code id="contract-address" class="text-lg font-mono text-amber-400 break-all cursor-pointer hover:text-amber-300 transition" 
              title="Click to copy address" onclick="copyContractAddress()">0x139FE32d2b79c9750D6dd6442097938A7EaA4444</code>
        <span id="copy-feedback" class="block text-xs text-green-400 mt-1 invisible">Copied!</span>
    </div>

    <script type="module">
        // --- Configuration ---
        const apiKey = "AIzaSyCG5GSa6R8GSRgcqef80XIUMc7B11c-uP8"; 
        const model = 'gemini-2.5-flash-image-preview';
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        // Fixed AI Prompt for Binance Wayfarers
        const FIXED_PROMPT = "Add a pair of black Wayfarer-style sunglasses with glowing yellow Binance logos on the lenses. The lenses should be black like dark sunglasses around the logos. Use the image located here as a template for the lenses: \"https://getbinanced.sirv.com/glasses.jpg\". The logos should be bright, symmetrical, and centered on each lens. Check that the logos on the lenses are accurate to the Binance logo. Keep the reflection and lighting natural to match the scene. Do not alter the personâ€™s face, pose, or background. Only add the sunglasses seamlessly as if they are being worn.";


        // --- DOM Elements ---
        const imageUpload = document.getElementById('image-upload');
        const generateButton = document.getElementById('generate-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const messageBox = document.getElementById('message-box');
        const imagePreview = document.getElementById('image-preview');
        const resultImage = document.getElementById('result-image');
        const resultContainer = document.getElementById('result-container');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const resultMessage = document.getElementById('result-message');
        const copyFeedback = document.getElementById('copy-feedback');
        
        let base64Image = null;

        // --- Utility Functions ---

        /**
         * Converts a File object into a Base64 string for the API payload.
         */
        const convertToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = (error) => reject(error);
            });
        };

        /**
         * Generic fetch function with exponential backoff for retries.
         */
        async function exponentialBackoffFetch(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        /**
         * Displays an error message.
         */
        const displayError = (message) => {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('bg-red-900', 'text-red-300');
        };

        /**
         * Clears all messages.
         */
        const clearMessage = () => {
            messageBox.classList.add('hidden');
            messageBox.textContent = '';
        };

        /**
         * Function to copy the contract address to the clipboard.
         */
        window.copyContractAddress = () => {
            const addressElement = document.getElementById('contract-address');
            const address = addressElement.textContent;
            
            const tempInput = document.createElement('textarea');
            tempInput.value = address;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                
                copyFeedback.textContent = 'Copied!';
                copyFeedback.classList.remove('invisible');
                setTimeout(() => { copyFeedback.classList.add('invisible'); }, 2000);
                
            } catch (err) {
                console.error('Could not copy text: ', err);
                copyFeedback.textContent = 'Failed to copy!';
                copyFeedback.classList.remove('invisible');
                setTimeout(() => { copyFeedback.classList.add('invisible'); }, 2000);
            }
            document.body.removeChild(tempInput);
        };


        // --- Event Handlers ---

        imageUpload.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            clearMessage();
            if (!file) {
                base64Image = null;
                // Reset to placeholder state
                imagePreview.src = "https://placehold.co/400x400/444444/bbbbbb?text=Upload+Your+Photo";
                imagePreview.style.display = 'block';
                resultImage.style.display = 'none';
                resultContainer.classList.add('hidden');
                generateButton.disabled = true;
                return;
            }

            // 1. Display a local preview of the uploaded image
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                resultImage.style.display = 'none';
                resultContainer.classList.remove('hidden'); // Show container when image is ready
                resultMessage.classList.add('hidden');
            };
            reader.readAsDataURL(file);

            // 2. Convert to Base64 for the API call
            try {
                base64Image = await convertToBase64(file);
                generateButton.disabled = false;
            } catch (e) {
                displayError('Error reading file. Please try a different image.');
                base64Image = null;
                generateButton.disabled = true;
            }
        });

        window.handleGenerate = async () => {
            if (!base64Image) {
                displayError('Please upload an image first.');
                return;
            }

            // --- UI State: Loading ---
            generateButton.disabled = true;
            buttonText.textContent = 'Generating...';
            loadingSpinner.classList.remove('hidden');
            clearMessage();
            resultImage.style.display = 'none';
            imagePreview.style.display = 'none'; // Hide input preview while loading
            imagePreviewContainer.classList.add('animate-pulse', 'bg-gray-800');


            const mimeType = imageUpload.files[0]?.type || 'image/jpeg';

            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [
                            { text: FIXED_PROMPT }, // Use the fixed prompt
                            {
                                inlineData: {
                                    mimeType: mimeType,
                                    data: base64Image
                                }
                            }
                        ]
                    }
                ],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl, options);
                const result = await response.json();
                
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (!base64Data) {
                    throw new Error('AI could not generate the image. Ensure the uploaded photo clearly shows a face.');
                }

                const imageUrl = `data:image/png;base64,${base64Data}`;

                // --- UI State: Success ---
                resultImage.src = imageUrl;
                resultImage.style.display = 'block'; // Show result image
                imagePreviewContainer.style.display = 'none'; // Hide placeholder container


            } catch (error) {
                console.error("API Call Error:", error);
                displayError(`Generation failed: ${error.message}.`);
                
                // Show the input preview image again on failure
                imagePreview.style.display = 'block';

            } finally {
                // --- UI State: Done ---
                generateButton.disabled = false;
                buttonText.textContent = 'Get Binanced';
                loadingSpinner.classList.add('hidden');
                imagePreviewContainer.classList.remove('animate-pulse', 'bg-gray-800');
                
                // Ensure the result container is visible if there was a success, or keep it hidden if there was no image uploaded previously.
                if (base64Image) {
                    resultContainer.classList.remove('hidden');
                } else {
                    resultContainer.classList.add('hidden');
                }
            }
        }

        // Initialize state on load
        document.addEventListener('DOMContentLoaded', () => {
             // Disable button initially until an image is uploaded
            generateButton.disabled = true;
            // Hide the placeholder container on load since no image is uploaded yet
            resultContainer.classList.add('hidden');
        });
    </script>

</body>

</html>
